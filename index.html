<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JDN - חדשות חרדים</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #f0f2f5; }
        
        .jdn-blue { background: linear-gradient(90deg, #17298D 0%, #2847F3 100%); }
        .jdn-red { background-color: #e31e24; }
        
        /* סידור המבנה הראשי: תוכן (מימין) ומבזקים (משמאל) */
        .page-layout {
            display: grid;
            grid-template-columns: 1fr 300px; /* הטור השמאלי למבזקים */
            gap: 15px;
        }

        /* גריד הריבועים של הכתבות */
        .news-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-auto-rows: 180px;
            gap: 10px;
        }

        .main-card { grid-column: span 2; grid-row: span 2; position: relative; overflow: hidden; border-radius: 4px; }
        .sub-card { position: relative; overflow: hidden; background: #fff; border-radius: 4px; }

        .card-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
        .sub-card:hover .card-img, .main-card:hover .card-img { transform: scale(1.05); }

        .card-overlay {
            position: absolute; bottom: 0; right: 0; left: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.85));
            padding: 12px; color: white;
        }

        .main-title { font-size: 1.6rem; font-weight: 800; line-height: 1.2; }
        .sub-title { font-size: 0.95rem; font-weight: 700; line-height: 1.2; }

        /* טור מבזקים בצד */
        .ticker-sidebar {
            background: white; border-top: 4px solid #e31e24;
            height: fit-content; border-radius: 4px; overflow: hidden;
        }
        .ticker-header { background: #f8f8f8; padding: 10px; font-weight: 800; color: #17298D; border-bottom: 1px solid #eee; }
        .ticker-item { padding: 10px; border-bottom: 1px solid #eee; font-size: 0.9rem; display: flex; gap: 8px; }
        .ticker-time { color: #e31e24; font-weight: bold; min-width: 40px; }

        @media (max-width: 1024px) { .page-layout { grid-template-columns: 1fr; } .ticker-sidebar { display: none; } }
    </style>
</head>
<body>

    <header class="jdn-blue py-3 shadow-md border-b-4 border-red-600">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <img src="https://www.jdn.co.il/wp-content/uploads/2022/01/logosite.png" alt="JDN" class="h-14">
            <div class="text-white font-bold hidden md:block">האתר החרדי המוביל בעולם</div>
        </div>
    </header>

    <div class="jdn-red text-white py-1 text-sm font-bold">
        <div class="container mx-auto px-4 flex">
            <div class="bg-white text-red-600 px-2 ml-3">חדשות</div>
            <marquee id="top-marquee" behavior="scroll" direction="right">טוען מבזקים...</marquee>
        </div>
    </div>

    <div class="container mx-auto mt-4 px-2">
        <div class="page-layout">
            
            <div>
                <div class="news-grid" id="news-container">
                    </div>
            </div>

            <aside class="ticker-sidebar shadow-md">
                <div class="ticker-header">מבזקי JDN</div>
                <div id="side-ticker">
                    </div>
            </aside>

        </div>
    </div>

    <script>
        async function loadJDN() {
            const repo = "yy0534105830-source/news";
            const response = await fetch(`https://api.github.com/repos/${repo}/contents/content/blog`);
            const files = await response.json();
            
            const container = document.getElementById('news-container');
            const sideTicker = document.getElementById('side-ticker');
            const topMarquee = document.getElementById('top-marquee');
            
            container.innerHTML = "";
            let tickerHTML = "";
            let marqueeText = "";

            // סינון וטעינת קבצים
            const articles = [];
            for (let file of files) {
                if (file.name.endsWith('.md')) {
                    const res = await fetch(file.download_url);
                    const text = await res.text();
                    const title = text.match(/title: "(.*)"/)?.[1] || "ללא כותרת";
                    const image = text.match(/image: "(.*)"/)?.[1] || "";
                    const pos = text.match(/layout_position: "(.*)"/)?.[1];
                    const time = text.match(/date: "(.*)"/)?.[1]?.split(' ')[1] || "00:00";
                    articles.push({ title, image, pos, time });
                }
            }

            articles.forEach((art, index) => {
                if (art.pos === "ticker") {
                    marqueeText += ` • ${art.title} `;
                    tickerHTML += `<div class="ticker-item"><span class="ticker-time">${art.time}</span><span>${art.title}</span></div>`;
                } else {
                    const isMain = (art.pos === "top");
                    const cardClass = isMain ? "main-card" : "sub-card";
                    const titleClass = isMain ? "main-title" : "sub-title";

                    container.innerHTML += `
                        <div class="${cardClass} shadow-md cursor-pointer bg-white">
                            <img src="${art.image}" class="card-img" alt="news">
                            <div class="card-overlay">
                                <h2 class="${titleClass}">${art.title}</h2>
                            </div>
                        </div>
                    `;
                }
            });

            sideTicker.innerHTML = tickerHTML;
            topMarquee.innerHTML = marqueeText;
        }
        loadJDN();
    </script>
</body>
</html>
